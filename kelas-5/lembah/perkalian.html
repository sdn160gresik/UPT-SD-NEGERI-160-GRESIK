<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Game Perkalian 2‚Äì9</title>

<style>
:root{
  --bg:#2e6e61;--panel:#3c816f;--panel-dark:#2a5c4f;
  --text:#fff;--right:#2ecc71;--wrong:#e74c3c;
}
*{box-sizing:border-box}
body{
  margin:0;min-height:100vh;display:grid;place-items:center;
  background:linear-gradient(160deg,var(--bg),#24594d);
  font-family:Poppins,system-ui,sans-serif;color:var(--text);
}
.app{
  width:min(900px,96vw);
  background:var(--panel);
  border-radius:22px;
  padding:24px;
}
header{display:flex;justify-content:space-between;flex-wrap:wrap}
.pill{background:var(--panel-dark);padding:8px 14px;border-radius:999px}

.screen{display:none}
.screen.active{display:block}

.btn{
  background:#58b68c;border:none;
  color:#09322a;font-weight:700;
  padding:12px 22px;border-radius:14px;
  cursor:pointer;
}

.option-grid{display:flex;gap:16px;flex-wrap:wrap;margin:20px 0}
.option-box{
  flex:1;min-width:220px;
  background:#2b6d5f;
  padding:16px;border-radius:16px;
  text-align:center;
}
select,input{
  width:100%;padding:10px;
  border-radius:10px;border:none;
  font-size:16px;text-align:center;
}

.question{
  background:#2b6d5f;
  border-radius:18px;
  padding:30px;
  display:grid;place-items:center;
  margin:20px 0;
}
.expr{font-size:72px;font-weight:900}

.feedback{height:32px;font-size:22px}
.correct{color:#2ecc71}
.wrong{color:#e74c3c}

.end{text-align:center}
.big-score{font-size:72px;font-weight:900}
.nilai-hijau{color:#2ecc71}
.nilai-kuning{color:#f1c40f}
.nilai-merah{color:#e74c3c}

/* TIMER */
.floating-timer{
  position:fixed;top:20px;left:50%;
  transform:translateX(-50%);
  background:rgba(255,255,255,.15);
  border:3px solid rgba(255,255,255,.3);
  padding:10px 30px;border-radius:999px;
  font-size:42px;font-weight:800;
  color:#fffb91;z-index:9999;
}
.floating-timer.low{
  color:#ff5757;
  animation:pulse .6s infinite alternate;
}
@keyframes pulse{
  from{transform:translateX(-50%) scale(1)}
  to{transform:translateX(-50%) scale(1.1)}
}
</style>
</head>

<body>

<div class="floating-timer" id="floatingTimer">‚è±Ô∏è 10</div>

<div class="app">
<header>
  <strong>üî¢ Perkalian 2‚Äì9</strong>
  <div>
    <span class="pill">Soal <b id="pNo">0</b>/<span id="pTotal">0</span></span>
    <span class="pill">Skor <b id="pScore">0</b></span>
    <span class="pill">Gagal <b id="pFail">0</b></span>
  </div>
</header>

<!-- START -->
<section class="screen active" id="startScreen">
  <h2>Siap bermain? üéØ</h2>
  <div class="option-grid">

    <div class="option-box">
      <label>Jumlah Soal</label>
      <select id="jumlah">
        <option>5</option>
        <option selected>10</option>
        <option>20</option>
        <option>50</option>
        <option>100</option>
      </select>
    </div>

    <div class="option-box">
      <label>Mode Perkalian</label>
      <select id="mode">
        <option value="campur">Campur</option>
        <option value="2">Perkalian 2</option>
        <option value="3">Perkalian 3</option>
        <option value="4">Perkalian 4</option>
        <option value="5">Perkalian 5</option>
        <option value="6">Perkalian 6</option>
        <option value="7">Perkalian 7</option>
        <option value="8">Perkalian 8</option>
        <option value="9">Perkalian 9</option>
      </select>
    </div>

    <div class="option-box">
      <label>Waktu per Soal</label>
      <select id="waktu">
        <option>1</option><option>2</option><option>3</option>
        <option>4</option><option>5</option>
        <option>6</option><option>7</option>
        <option>8</option><option>9</option>
        <option selected>10</option>
      </select>
    </div>

    <div class="option-box">
      <label>Batas Kegagalan</label>
      <select id="batasGagal">
        <option value="0">Tidak ada batas üöÄ</option>
      </select>
    </div>

  </div>
  <button class="btn" id="btnStart">Mulai ‚ñ∂</button>
</section>

<!-- GAME -->
<section class="screen" id="gameScreen">
  <div class="question"><div class="expr" id="expr"></div></div>
  <input type="number" id="answer" placeholder="Jawaban">
  <br><br>
  <button class="btn" id="btnCheck">Periksa</button>
  <div class="feedback" id="feedback"></div>
</section>

<!-- END -->
<section class="screen end" id="endScreen">
  <div id="finalScore" class="big-score"></div>
  <p id="finalMsg"></p>
  <button class="btn" onclick="location.reload()">Main Lagi üîÅ</button>
</section>
</div>

<script>
let TIME_LIMIT=10,timeLeft,timer;
let pairs=[],idx=0,score=0,total=0;
let fail=0,failLimit=0;

const floatingTimer=document.getElementById("floatingTimer");

/* üîî BEEP */
function beep(){
  const ctx=new (window.AudioContext||window.webkitAudioContext)();
  const osc=ctx.createOscillator();
  const gain=ctx.createGain();
  osc.frequency.value=800;
  gain.gain.value=0.15;
  osc.connect(gain);gain.connect(ctx.destination);
  osc.start();
  osc.stop(ctx.currentTime+0.15);
}

/* pilihan gagal 1‚Äì100 */
const batasSelect=document.getElementById("batasGagal");
for(let i=1;i<=100;i++){
  const opt=document.createElement("option");
  opt.value=i;
  opt.textContent=i+" kali";
  if(i===3) opt.selected=true;
  batasSelect.appendChild(opt);
}

function startGame(){
  TIME_LIMIT=parseInt(waktu.value);
  failLimit=parseInt(batasGagal.value);

  const n=parseInt(jumlah.value);
  const mode=document.getElementById("mode").value;

  let all=[];
  if(mode==="campur"){
    for(let a=2;a<=9;a++)for(let b=2;b<=9;b++)all.push({a,b});
  }else{
    const m=parseInt(mode);
    for(let b=2;b<=9;b++)all.push({a:m,b});
  }

  pairs=all.sort(()=>Math.random()-0.5).slice(0,n);
  idx=0;score=0;fail=0;total=pairs.length;

  startScreen.classList.remove("active");
  gameScreen.classList.add("active");
  next();
}

function next(){
  if(idx>=pairs.length){endGame();return;}
  const q=pairs[idx];
  expr.textContent=`${q.a} √ó ${q.b}`;
  answer.value="";feedback.textContent="";
  pNo.textContent=idx+1;pTotal.textContent=total;pScore.textContent=score;
  startTimer();
}

function startTimer(){
  clearInterval(timer);
  timeLeft=TIME_LIMIT;
  updateTimer();
  timer=setInterval(()=>{
    timeLeft--;updateTimer();
    if(timeLeft<=3 && timeLeft>0) beep();
    if(timeLeft<=0){
      fail++;checkFail();
      idx++;next();
    }
  },1000);
}

function updateTimer(){
  floatingTimer.textContent="‚è±Ô∏è "+timeLeft;
  floatingTimer.classList.toggle("low",timeLeft<=3);
}

btnCheck.onclick=()=>{
  clearInterval(timer);
  const {a,b}=pairs[idx];
  const val=parseInt(answer.value);
  if(val===a*b){
    score++;feedback.textContent="‚úÖ Benar!";
    feedback.className="feedback correct";
  }else{
    fail++;feedback.textContent="‚ùå Salah";
    feedback.className="feedback wrong";
    checkFail();
  }
  idx++;setTimeout(next,600);
};

function checkFail(){
  pFail.textContent=fail;
  if(failLimit!==0 && fail>=failLimit){
    alert("‚ùå Batas kegagalan tercapai!\nGame diulang dari awal üí™");
    location.reload();
  }
}

function endGame(){
  gameScreen.classList.remove("active");
  endScreen.classList.add("active");
  const pct=Math.round(score/total*100);
  finalScore.textContent=pct;
  finalScore.className=
    "big-score "+(pct>=75?"nilai-hijau":pct>=50?"nilai-kuning":"nilai-merah");
  finalMsg.textContent=pct>=75?"Hebat sekali! üåü":"Ayo latihan lagi! üöÄ";
}

btnStart.onclick=startGame;
</script>

</body>
</html>
